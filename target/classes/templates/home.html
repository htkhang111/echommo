<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security6">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EchoMMO - Home</title>

    <link rel="stylesheet" th:href="@{/css/home.css}">
    <link rel="stylesheet" th:href="@{/css/common.css}">
    <link rel="stylesheet" th:href="@{/css/header.css}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
</head>

<body>
<div class="home-container">
    <!-- HEADER FRAGMENT -->
    <div th:replace="~{fragments/header :: header}"></div>

    <div class="layout">
        <!-- Sidebar -->
        <div th:replace="~{fragments/sidebar :: sidebar(activePage='home')}"></div>

        <main class="main-content">
            <section class="journey-section">
                <div class="journey-bg"></div>
                <h1 class="journey-title">üöÄ H√†nh tr√¨nh GameFi</h1>
                <p id="journey-typing" class="journey-typing"></p>

                <div class="progress-container">
                    <div class="progress-label">Ti·∫øn tr√¨nh nh√¢n v·∫≠t</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 45%;"></div>
                    </div>
                    <span class="progress-text">Level 45 / 100</span>
                </div>

                <div class="action-cards">
                    <div class="quick-card" th:onclick="'location.href=\'' + @{/minigame} + '\''">
                        <i class="fas fa-dragon"></i>
                        <h3>Phi√™u l∆∞u</h3>
                        <p>Tham gia chi·∫øn ƒë·∫•u v√† kh√°m ph√° th·∫ø gi·ªõi m·ªõi.</p>
                    </div>
                    <div class="quick-card" th:onclick="'location.href=\'' + @{/marketplace} + '\''">
                        <i class="fas fa-store"></i>
                        <h3>Marketplace</h3>
                        <p>Mua b√°n v·∫≠t ph·∫©m qu√Ω hi·∫øm v·ªõi ng∆∞·ªùi ch∆°i kh√°c.</p>
                    </div>
                    <div class="quick-card" th:onclick="'location.href=\'' + @{/inventory} + '\''">
                        <i class="fas fa-box-open"></i>
                        <h3>Kho ƒë·ªì</h3>
                        <p>Qu·∫£n l√Ω trang b·ªã v√† v·∫≠t ph·∫©m c·ªßa b·∫°n.</p>
                    </div>
                    <div class="quick-card" th:onclick="'location.href=\'' + @{/profile} + '\''">
                        <i class="fas fa-user-cog"></i>
                        <h3>H·ªì s∆°</h3>
                        <p>Xem th√¥ng tin v√† n√¢ng c·∫•p nh√¢n v·∫≠t.</p>
                    </div>
                    <div class="quick-card" id="openFriendPanel">
                        <i class="fas fa-user-friends"></i>
                        <h3>B·∫°n b√®</h3>
                        <p>K·∫øt n·ªëi v·ªõi b·∫°n b√® trong EchoMMO.</p>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <div th:replace="~{fragments/footer :: footer}"></div>
</div>

<!-- CHAT PANEL HTML (ƒê√É DI CHUY·ªÇN RA NGO√ÄI HEADER) -->
<div class="chat-panel" id="chatPanel">
    <div class="chat-header">
        <h3 id="chatFriendName">Chat v·ªõi [T√™n b·∫°n b√®]</h3>
        <button id="closeChatPanel"><i class="fas fa-times"></i></button>
    </div>
    
    <div class="chat-messages" id="chatMessages">
        <div class="message-item friend">
            <p>Chat ƒë√£ s·∫µn s√†ng! G·ª≠i tin nh·∫Øn ƒë·∫ßu ti√™n!</p>
            <span class="timestamp">15:00</span>
        </div>
    </div>
    
    <div class="chat-input">
        <input type="text" id="messageInput" placeholder="G√µ tin nh·∫Øn...">
        <button id="sendMessageBtn"><i class="fas fa-paper-plane"></i></button>
    </div>
    <input type="hidden" id="currentReceiverUsername"> 
</div>
<!-- K·∫æT TH√öC CHAT PANEL -->

<script th:src="@{/js/common.js}"></script>
<!-- üí° LINK ƒê·∫æN FILE JS ƒê√É FIX L·ªñI -->
<script th:src="@{/js/header.js}"></script> 
<script th:inline="javascript">
    // ===== G√ï CH·ªÆ ƒê·ªòNG =====
    const lines = [
        "Kh·ªüi ƒë·∫ßu chuy·∫øn phi√™u l∆∞u vƒ© ƒë·∫°i trong th·∫ø gi·ªõi EchoMMO...",
        "Chi·∫øn ƒë·∫•u, thu th·∫≠p v√† chinh ph·ª•c nh·ªØng v√πng ƒë·∫•t b√≠ ·∫©n...",
        "Vinh quang ch·ªâ d√†nh cho nh·ªØng chi·∫øn binh d≈©ng c·∫£m!"
    ];
    const el = document.getElementById("journey-typing");
    let line = 0, char = 0;

    function typingEffect() {
        if (line < lines.length) {
            if (char < lines[line].length) {
                el.textContent += lines[line].charAt(char);
                char++;
                setTimeout(typingEffect, 40);
            } else {
                setTimeout(() => {
                    el.textContent = "";
                    char = 0;
                    line++;
                    typingEffect();
                }, 1500);
            }
        } else {
            line = 0;
            setTimeout(typingEffect, 1000);
        }
    }
    typingEffect();
</script>
</body>
</html>