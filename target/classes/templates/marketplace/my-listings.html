<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security6">
<head>
    <meta charset="UTF-8">
    <title>Đăng bán của tôi - EchoMMO</title>
	<link rel="stylesheet" th:href="@{/css/header.css}">
    <link rel="stylesheet" th:href="@{/css/common.css}">
    <link rel="stylesheet" th:href="@{/css/inventory.css}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
     <style>
         .rarity-badge { padding: 2px 8px; border-radius: 12px; font-size: 0.8rem; font-weight: bold; color: white; text-shadow: 1px 1px 1px rgba(0,0,0,0.5); display: inline-block;}
         .rarity-common { background: #9ca3af; }
         .rarity-rare { background: #3b82f6; }
         .rarity-epic { background: #a855f7; }
         .rarity-legendary { background: #f59e0b; }

         .notification { position: fixed; top: 20px; right: 20px; padding: 1rem 1.5rem; color: white; border-radius: 8px; z-index: 9999; animation: slideIn 0.3s ease; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
         .notification-success { background: #10b981; }
         .notification-error { background: #ef4444; }
         @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
         @keyframes slideOut { to { transform: translateX(100%); opacity: 0; } }

         .btn { padding: 8px 15px; border-radius: 6px; border: none; cursor: pointer; transition: background 0.3s; font-weight: bold; }
         .btn-sm { padding: 5px 10px; font-size: 0.9em; }
         .btn-primary { background: #3b82f6; color: white; } .btn-primary:hover { background: #2563eb; }
         .btn-danger { background: #ef4444; color: white; } .btn-danger:hover { background: #dc2626; }

         .my-listings-container { background: var(--bg-card); padding: 1.5rem; border-radius: 12px; }
         .listings-table table { width: 100%; border-collapse: collapse; }
         .listings-table th, .listings-table td { padding: 12px 15px; border-bottom: 1px solid #374151; text-align: left; }
         .listings-table th { color: #a0aec0; font-size: 0.9em; text-transform: uppercase; }
         .listings-table td { color: #e2e8f0; }
         .item-cell { display: flex; align-items: center; gap: 10px; }
         .item-cell img { width: 32px; height: 32px; object-fit: contain; background: #2d3748; border-radius: 4px; padding: 2px; }
         .badge { padding: 3px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: bold; color: white; text-transform: uppercase; }
         .badge-player { background: #3b82f6; }
         .badge-admin { background: #ef4444; }
         .badge-system { background: #6b7280; }

          .empty-state { text-align: center; padding: 4rem 2rem; color: #6b7280; }
          .empty-state i { font-size: 4rem; margin-bottom: 1rem; }
          .empty-state p { font-size: 1.2rem; margin-bottom: 1.5rem; }
     </style>
</head>
<body>
<div class="home-container">
    <div th:replace="~{fragments/header :: header}"></div>

    <div class="layout">
         <div th:replace="~{fragments/sidebar :: sidebar (activePage='my-listings')}"></div>

        <main class="main-content">
            <h1><i class="fas fa-tag"></i> Đăng bán của tôi (Đang hoạt động)</h1>

            <div class="my-listings-container">
                <div th:if="${listings.isEmpty()}" class="empty-state">
                    <i class="fas fa-inbox"></i>
                    <p>Bạn chưa có đăng bán nào đang hoạt động</p>
                    <button class="btn btn-primary" onclick="location.href='/marketplace/create'">
                        <i class="fas fa-plus"></i> Tạo đăng bán mới
                    </button>
                </div>

                <div class="listings-table" th:if="${!listings.isEmpty()}">
                    <table>
                        <thead>
                            <tr>
                                <th>Vật phẩm</th>
                                <th>Số lượng</th>
                                <th>Giá</th>
                                <th>Loại</th>
                                <th>Ngày đăng</th>
                                <th>Hành động</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="listing : ${listings}">
                                <td>
                                    <div class="item-cell">
                                        <img th:src="${listing.imageUrl != null ? listing.imageUrl : '/images/items/default.png'}"
                                             th:alt="${listing.itemName}">
                                        <span th:text="${listing.itemName}">Item Name</span>
                                    </div>
                                </td>
                                <td>x<span th:text="${listing.quantity}">1</span></td>
                                <td><i class="fas fa-coins"></i> <span th:text="${#numbers.formatDecimal(listing.price, 1, 'COMMA', 2, 'POINT')}">100.00</span></td>
                                <td>
                                    <span class="badge" th:classappend="${#strings.equalsIgnoreCase(listing.priceType,'Admin') ? 'badge-admin' : (#strings.equalsIgnoreCase(listing.priceType,'System') ? 'badge-system' : 'badge-player')}"
                                          th:text="${listing.priceType}">Player</span>
                                </td>
                                <td th:text="${#temporals.format(listing.createdAt, 'dd/MM/yyyy HH:mm')}">01/01/2025</td>
                                <td>
                                    <button class="btn btn-danger btn-sm"
                                            th:onclick="'cancelListing(' + ${listing.listingId} + ')'">
                                        <i class="fas fa-times"></i> Hủy
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>
     <div th:replace="~{fragments/footer :: footer}"></div>
</div>

<script th:src="@{/js/common.js}"></script>
<script th:src="@{/js/my-listings.js}"></script>
<script th:src="@{/js/header.js}"></script>
</body>
</html>